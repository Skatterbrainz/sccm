<?xml version="1.0" encoding="UTF-8"?>
<queries comment="1808.31.01">
	<query type="cm" name="Site Status Summary" exp="Select SiteStatus.SiteCode, SiteInfo.SiteName, SiteStatus.Updated 'Time Stamp', Case SiteStatus.Status When 0 Then 'OK' When 1 Then 'Warning' When 2 Then 'Critical' Else ' ' End AS 'Site Status', Case SiteInfo.Status When 1 Then 'Active' When 2 Then 'Pending' When 3 Then 'Failed' When 4 Then 'Deleted' When 5 Then 'Upgrade' Else ' ' END AS 'Site State' From dbo.v_SummarizerSiteStatus SiteStatus Join v_Site SiteInfo on SiteStatus.SiteCode = SiteInfo.SiteCode Order By SiteCode" />
	<query type="cm" name="Component Status Summary" exp="SELECT distinct Case v_ComponentSummarizer.Status When 0 Then 'OK' When 1 Then 'Warning' When 2 Then 'Critical' Else ' ' End As 'Status', SiteCode 'Site Code', MachineName 'Site System', ComponentName 'Component', Case v_componentSummarizer.State When 0 Then 'Stopped' When 1 Then 'Started' When 2 Then 'Paused' When 3 Then 'Installing' When 4 Then 'Re-Installing' When 5 Then 'De-Installing' Else ' ' END AS 'Thread State', Errors 'Errors', Warnings 'Warnings', Infos 'Information', Case v_componentSummarizer.Type When 0 Then 'Autostarting' When 1 Then 'Scheduled' When 2 Then 'Manual' ELSE ' ' END AS 'Startup Type', CASE AvailabilityState When 0 Then 'Online' When 3 Then 'Offline' ELSE ' ' END AS 'Availability State', NextScheduledTime 'Next Scheduled', LastStarted 'Last Started', LastContacted 'Last Status Message', LastHeartbeat 'Last Heartbeat', HeartbeatInterval 'Heartbeat Interval', ComponentType 'Type' from v_ComponentSummarizer Where TallyInterval = '0001128000100008' Order By ComponentName" />
	<query type="cm" name="Database Index Fragmentation Summary" exp="SELECT COUNT(*) AS BadFrags FROM (SELECT dbschemas.[name] as 'Schema',dbtables.[name] as 'Table',dbindexes.[name] as 'Index',ROUND(indexstats.avg_fragmentation_in_percent, 2) as 'FragPct', indexstats.page_count as 'Pages' FROM sys.dm_db_index_physical_stats (DB_ID(), NULL, NULL, NULL, NULL) AS indexstats INNER JOIN sys.tables dbtables on dbtables.[object_id] = indexstats.[object_id] INNER JOIN sys.schemas dbschemas on dbtables.[schema_id] = dbschemas.[schema_id] INNER JOIN sys.indexes AS dbindexes ON dbindexes.[object_id] = indexstats.[object_id] AND indexstats.index_id = dbindexes.index_id WHERE indexstats.database_id = DB_ID() ) AS T1 WHERE T1.FragPct > 30" />
	<query type="cm" name="Database Index Fragmentation Details" exp="SELECT dbschemas.[name] as 'Schema',dbtables.[name] as 'Table',dbindexes.[name] as 'Index',ROUND(indexstats.avg_fragmentation_in_percent, 2) as 'FragPct', indexstats.page_count as 'Pages' FROM sys.dm_db_index_physical_stats (DB_ID(), NULL, NULL, NULL, NULL) AS indexstats INNER JOIN sys.tables dbtables on dbtables.[object_id] = indexstats.[object_id] INNER JOIN sys.schemas dbschemas on dbtables.[schema_id] = dbschemas.[schema_id] INNER JOIN sys.indexes AS dbindexes ON dbindexes.[object_id] = indexstats.[object_id] AND indexstats.index_id = dbindexes.index_id WHERE indexstats.database_id = DB_ID() ORDER BY FragPct DESC" />
	<query type="cm" name="Client Health Summary" exp="SELECT DISTINCT HealthStateName, COUNT(*) AS QTY FROM dbo.v_ClientHealthState GROUP BY HealthStateName ORDER BY HealthStateName" />
	<query type="cm" name="Client Offer Summary" exp="SELECT [Targeted],[Accepted],[NotStarted],[Waiting],[Running],[Retrying],[Failed],[Succeeded],[Active1],[Active7],[Active30],[HealthyTargeted],[HealthyAccepted],[HealthyNotStarted],[HealthyWaiting],[HealthyRunning],[HealthyRetrying],[HealthyFailed],[HealthySucceeded],[SiteNumber] FROM [dbo].[ClientOfferSummary]" />
	<query type="cm" name="Content Distribution Summary" exp="SELECT dbo.v_ContDistStatSummary.PkgID, dbo.v_Package.Name, dbo.v_ContDistStatSummary.TargeteddDPCount AS Targeted, dbo.v_ContDistStatSummary.NumberInstalled AS Installed, dbo.v_ContDistStatSummary.NumberInProgress AS InProgress, dbo.v_ContDistStatSummary.NumberErrors AS Failed, dbo.v_Package.SourceVersion AS Version FROM dbo.v_ContDistStatSummary INNER JOIN dbo.v_Package ON dbo.v_ContDistStatSummary.PkgID = dbo.v_Package.PackageID ORDER BY dbo.v_Package.Name" />
	<query type="cm" name="Devices by AD Site" exp="SELECT AD_Site_Name0 AS ADSite, COUNT(ResourceID) AS Devices FROM dbo.v_R_System GROUP BY AD_Site_Name0" />
	<query type="cm" name="Client Installs" exp="SELECT CASE WHEN Client0 = 1 THEN 'Client' ELSE 'No Client' END AS ClientType, COUNT(Client0) AS Clients FROM dbo.v_R_System GROUP BY Client0" />
	<query type="cm" name="Client Versions" exp="SELECT DISTINCT COALESCE (Client_Version0, 'None') AS ClientVersion, COUNT(*) AS Clients FROM dbo.v_R_System GROUP BY Client_Version0 ORDER BY ClientVersion" />
	<query type="cm" name="Client Operating Systems" exp="SELECT DISTINCT Operating_System_Name_and0 AS OperatingSystem, COUNT(*) AS Clients FROM dbo.v_R_System GROUP BY Operating_System_Name_and0 ORDER BY OperatingSystem" />
	<query type="cm" name="Packages Summary" exp="SELECT [PackageID],[Name],[Version],[Manufacturer],[PkgSourceFlag],[PkgSourcePath],[SourceVersion],[SourceDate],[Priority],[ImageFlags] ,CASE WHEN [PackageType]=258 THEN 'Boot Image' WHEN [PackageType]=257 THEN 'OS Image' WHEN [PackageType]=259 THEN 'OS Upgrade Pkg' WHEN [PackageType]=4 THEN 'Task Sequence' WHEN [PackageType]=8 THEN 'Application' ELSE 'Package' END AS PackageType FROM dbo.v_Package ORDER BY Name" />
	<query type="cm" name="User Groups" exp="SELECT * FROM dbo.v_R_UserGroup ORDER BY Name0" />
	<query type="cm" name="Users" exp="SELECT * FROM dbo.v_R_User ORDER BY User_Name0" />
	<query type="cm" name="Site Admins" exp="SELECT [AdminID],[AdminSID],[LogonName],[DisplayName],CASE WHEN [IsGroup]=1 THEN 'TRUE' ELSE 'FALSE' END AS 'IsGroup',CASE WHEN [IsDeleted]=1 THEN 'TRUE' ELSE 'FALSE' END AS 'IsDeleted',[CreatedDate],[ModifiedDate],[AccountType] FROM dbo.v_Admins ORDER BY DisplayName" />
</queries>

